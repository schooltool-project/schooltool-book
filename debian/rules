#!/usr/bin/make -f

VERSION := $(shell dpkg-parsechangelog | sed -rne 's,^Version: ([^-]+).*,\1,p')

%:
	dh $@

override_dh_auto_build:
	make html

override_dh_compress:
	dh_compress -X_sources

override_dh_link:
	# use system copies of javascript libraries instead
	for jsname in jquery underscore doctools searchtools sidebar; do \
		for filename in `find debian/ -wholename */_static/$$jsname.js`; do \
			rm $$filename; \
			ln -s /usr/share/javascript/sphinxdoc/1.0/$$jsname.js $$filename; \
		done; \
	done
	dh_link

override_dh_install:
	dh_install --list-missing -Xwebsupport.js

override_dh_installdocs:
	dh_installdocs -Xwebsupport.js

get-orig-source:
	bzr export -r tag:$(VERSION) --root=schooltool-book-$(VERSION).orig \
		schooltool-book_$(VERSION).tar.gz lp:schooltool-book
